<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë§ˆíŠ¸ ì´ë¯¸ì§€ í¬ë¡­í¼</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #fafafa;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .header {
            padding: 30px 40px;
            border-bottom: 1px solid #e5e7eb;
        }

        h1 {
            color: #111827;
            font-size: 2.5em;
            font-weight: 700;
            letter-spacing: -0.025em;
            text-align: center;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #6b7280;
            font-size: 1.1em;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
        }

        .tab {
            flex: 1;
            padding: 20px;
            background: #f9fafb;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.2s ease;
            border-right: 1px solid #e5e7eb;
        }

        .tab:last-child {
            border-right: none;
        }

        .tab.active {
            background: white;
            color: #111827;
            border-bottom: 2px solid #111827;
        }

        .tab:hover:not(.active) {
            background: #f3f4f6;
            color: #374151;
        }

        .tab-content {
            padding: 40px;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 60px 40px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #f9fafb;
        }

        .upload-area:hover {
            border-color: #6b7280;
            background: #f3f4f6;
        }

        .upload-area.dragover {
            border-color: #374151;
            background: #f3f4f6;
            transform: scale(1.01);
        }

        .upload-icon {
            font-size: 4em;
            color: #6b7280;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.3em;
            color: #4b5563;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .upload-subtext {
            color: #6b7280;
            font-size: 1em;
            margin-bottom: 20px;
        }

        .upload-btn {
            background: #111827;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .upload-btn:hover {
            background: #1f2937;
            transform: translateY(-1px);
        }

        .file-input {
            display: none;
        }

        .preview-container {
            display: none;
            margin-bottom: 30px;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .preview-item {
            position: relative;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }

        .preview-img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .preview-name {
            padding: 8px;
            font-size: 0.8em;
            color: #6b7280;
            text-align: center;
            border-top: 1px solid #e5e7eb;
        }

        .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .process-btn {
            background: #111827;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            margin-bottom: 20px;
        }

        .process-btn:hover:not(:disabled) {
            background: #1f2937;
            transform: translateY(-1px);
        }

        .process-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .progress-container {
            display: none;
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #111827;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            color: #6b7280;
            font-size: 0.9em;
        }

        .result-container {
            display: none;
        }

        .result-summary {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .result-title {
            color: #166534;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .result-stats {
            color: #15803d;
            font-size: 0.9em;
        }

        .download-btn {
            background: #059669;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
        }

        .download-btn:hover {
            background: #047857;
            transform: translateY(-1px);
        }

        .info-box {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .info-title {
            color: #1e40af;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .info-list {
            color: #1e3a8a;
            font-size: 0.9em;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 8px;
            }

            .header {
                padding: 20px;
            }

            h1 {
                font-size: 2em;
            }

            .tab-content {
                padding: 20px;
            }

            .upload-area {
                padding: 40px 20px;
            }

            .preview-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âœ‚ï¸ ìŠ¤ë§ˆíŠ¸ ì´ë¯¸ì§€ í¬ë¡­í¼</h1>
            <p class="subtitle">ì¸ë„¤ì¼ê³¼ ë³¸ë¬¸ìš© ì´ë¯¸ì§€ë¥¼ í•œë²ˆì— ìƒì„±í•˜ì„¸ìš”</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('thumbnail')">
                ğŸ“¸ ì¸ë„¤ì¼ìš© (ë‹¤ì¤‘ ì—…ë¡œë“œ)
            </button>
            <button class="tab" onclick="switchTab('content')">
                ğŸ“„ ë³¸ë¬¸ìš© (ë‹¨ì¼ ì—…ë¡œë“œ)
            </button>
        </div>

        <!-- ì¸ë„¤ì¼ìš© íƒ­ -->
        <div id="thumbnail" class="tab-content active">
            <div class="info-box">
                <div class="info-title">ğŸ“¸ ì¸ë„¤ì¼ìš© ì´ë¯¸ì§€ ë³€í™˜</div>
                <div class="info-list">
                    â€¢ ìµœëŒ€ 7ê°œ ì´ë¯¸ì§€ ì—…ë¡œë“œ<br>
                    â€¢ ê° ì´ë¯¸ì§€ë§ˆë‹¤ 610Ã—477 ì‚¬ì´ì¦ˆë¡œ ë³€í™˜<br>
                    â€¢ íŒŒì¼ëª…: b1.jpg, b2.jpg ... b7.jpg<br>
                    â€¢ ì´ 7ê°œ íŒŒì¼ ìƒì„±
                </div>
            </div>

            <div class="upload-area" id="thumbnailUpload">
                <div class="upload-icon">ğŸ“</div>
                <div class="upload-text">ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
                <div class="upload-subtext">ìµœëŒ€ 7ê°œ íŒŒì¼ (JPG, PNG, GIF, WebP)</div>
                <button class="upload-btn" onclick="document.getElementById('thumbnailInput').click()">
                    íŒŒì¼ ì„ íƒ
                </button>
                <input type="file" id="thumbnailInput" class="file-input" multiple accept="image/*">
            </div>

            <div id="thumbnailPreview" class="preview-container">
                <h3>ì—…ë¡œë“œëœ ì´ë¯¸ì§€ (<span id="thumbnailCount">0</span>/7)</h3>
                <div id="thumbnailGrid" class="preview-grid"></div>
            </div>

            <button id="thumbnailProcess" class="process-btn" disabled>
                ì¸ë„¤ì¼ ì´ë¯¸ì§€ ìƒì„±í•˜ê¸°
            </button>

            <div id="thumbnailProgress" class="progress-container">
                <div class="progress-bar">
                    <div id="thumbnailProgressFill" class="progress-fill"></div>
                </div>
                <div id="thumbnailProgressText" class="progress-text">ì²˜ë¦¬ ì¤‘...</div>
            </div>

            <div id="thumbnailResult" class="result-container">
                <div class="result-summary">
                    <div class="result-title">âœ… ë³€í™˜ ì™„ë£Œ!</div>
                    <div class="result-stats" id="thumbnailStats"></div>
                </div>
                <button id="thumbnailDownload" class="download-btn">
                    ZIP íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ
                </button>
            </div>
        </div>

        <!-- ë³¸ë¬¸ìš© íƒ­ -->
        <div id="content" class="tab-content">
            <div class="info-box">
                <div class="info-title">ğŸ“„ ë³¸ë¬¸ìš© ì´ë¯¸ì§€ ë³€í™˜</div>
                <div class="info-list">
                    â€¢ 1ê°œ ì´ë¯¸ì§€ ì—…ë¡œë“œ<br>
                    â€¢ ì •ë°©í˜•ìœ¼ë¡œ 12ê°€ì§€ ì‚¬ì´ì¦ˆ ë³€í™˜: 60, 120, 125, 130, 160, 180, 210, 240, 303, 470, 500, 800px<br>
                    â€¢ PNGì™€ JPG ë‘ ê°€ì§€ í˜•ì‹ìœ¼ë¡œ ìƒì„±<br>
                    â€¢ ì´ 24ê°œ íŒŒì¼ ìƒì„± (12ì‚¬ì´ì¦ˆ Ã— 2í˜•ì‹)
                </div>
            </div>

            <div class="upload-area" id="contentUpload">
                <div class="upload-icon">ğŸ–¼ï¸</div>
                <div class="upload-text">ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
                <div class="upload-subtext">1ê°œ íŒŒì¼ë§Œ (JPG, PNG, GIF, WebP)</div>
                <button class="upload-btn" onclick="document.getElementById('contentInput').click()">
                    íŒŒì¼ ì„ íƒ
                </button>
                <input type="file" id="contentInput" class="file-input" accept="image/*">
            </div>

            <div id="contentPreview" class="preview-container">
                <h3>ì—…ë¡œë“œëœ ì´ë¯¸ì§€</h3>
                <div id="contentGrid" class="preview-grid"></div>
            </div>

            <button id="contentProcess" class="process-btn" disabled>
                ë³¸ë¬¸ìš© ì´ë¯¸ì§€ ìƒì„±í•˜ê¸°
            </button>

            <div id="contentProgress" class="progress-container">
                <div class="progress-bar">
                    <div id="contentProgressFill" class="progress-fill"></div>
                </div>
                <div id="contentProgressText" class="progress-text">ì²˜ë¦¬ ì¤‘...</div>
            </div>

            <div id="contentResult" class="result-container">
                <div class="result-summary">
                    <div class="result-title">âœ… ë³€í™˜ ì™„ë£Œ!</div>
                    <div class="result-stats" id="contentStats"></div>
                </div>
                <button id="contentDownload" class="download-btn">
                    ZIP íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ
                </button>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let thumbnailFiles = [];
        let contentFile = null;
        let thumbnailZip = null;
        let contentZip = null;

        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            // ëª¨ë“  íƒ­ê³¼ ì½˜í…ì¸  ë¹„í™œì„±í™”
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ê³¼ ì½˜í…ì¸  í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // ê²°ê³¼ ì´ˆê¸°í™”
            resetResults();
        }

        // ê²°ê³¼ ì´ˆê¸°í™”
        function resetResults() {
            document.querySelectorAll('.progress-container, .result-container').forEach(el => {
                el.style.display = 'none';
            });
            document.querySelectorAll('.progress-fill').forEach(el => {
                el.style.width = '0%';
            });
        }

        // ì¸ë„¤ì¼ìš© ì—…ë¡œë“œ ì„¤ì •
        setupUpload('thumbnail', 7, (files) => {
            thumbnailFiles = Array.from(files).slice(0, 7);
            displayThumbnailPreview();
            document.getElementById('thumbnailProcess').disabled = thumbnailFiles.length === 0;
        });

        // ë³¸ë¬¸ìš© ì—…ë¡œë“œ ì„¤ì •
        setupUpload('content', 1, (files) => {
            contentFile = files[0];
            displayContentPreview();
            document.getElementById('contentProcess').disabled = !contentFile;
        });

        // ì—…ë¡œë“œ ê¸°ëŠ¥ ì„¤ì •
        function setupUpload(type, maxFiles, callback) {
            const uploadArea = document.getElementById(type + 'Upload');
            const fileInput = document.getElementById(type + 'Input');

            // ë“œë˜ê·¸ ì•¤ ë“œë¡­
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files).filter(file => 
                    file.type.startsWith('image/')
                ).slice(0, maxFiles);
                callback(files);
            });

            // í´ë¦­ ì—…ë¡œë“œ
            uploadArea.addEventListener('click', (e) => {
                if (e.target.id !== type + 'Input' && !e.target.closest('.upload-btn')) {
                    fileInput.click();
                }
            });

            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files).filter(file => 
                    file.type.startsWith('image/')
                ).slice(0, maxFiles);
                callback(files);
                e.target.value = '';
            });
        }

        // ì¸ë„¤ì¼ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        function displayThumbnailPreview() {
            const grid = document.getElementById('thumbnailGrid');
            const container = document.getElementById('thumbnailPreview');
            const count = document.getElementById('thumbnailCount');
            
            grid.innerHTML = '';
            count.textContent = thumbnailFiles.length;

            if (thumbnailFiles.length > 0) {
                container.style.display = 'block';
                
                thumbnailFiles.forEach((file, index) => {
                    const item = document.createElement('div');
                    item.className = 'preview-item';
                    
                    const img = document.createElement('img');
                    img.className = 'preview-img';
                    img.src = URL.createObjectURL(file);
                    
                    const name = document.createElement('div');
                    name.className = 'preview-name';
                    name.textContent = `b${index + 1}.jpg`;
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'remove-btn';
                    removeBtn.textContent = 'Ã—';
                    removeBtn.onclick = () => {
                        thumbnailFiles.splice(index, 1);
                        displayThumbnailPreview();
                        document.getElementById('thumbnailProcess').disabled = thumbnailFiles.length === 0;
                    };
                    
                    item.appendChild(img);
                    item.appendChild(name);
                    item.appendChild(removeBtn);
                    grid.appendChild(item);
                });
            } else {
                container.style.display = 'none';
            }
        }

        // ë³¸ë¬¸ìš© ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        function displayContentPreview() {
            const grid = document.getElementById('contentGrid');
            const container = document.getElementById('contentPreview');
            
            grid.innerHTML = '';

            if (contentFile) {
                container.style.display = 'block';
                
                const item = document.createElement('div');
                item.className = 'preview-item';
                
                const img = document.createElement('img');
                img.className = 'preview-img';
                img.src = URL.createObjectURL(contentFile);
                
                const name = document.createElement('div');
                name.className = 'preview-name';
                name.textContent = contentFile.name;
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.textContent = 'Ã—';
                removeBtn.onclick = () => {
                    contentFile = null;
                    displayContentPreview();
                    document.getElementById('contentProcess').disabled = true;
                };
                
                item.appendChild(img);
                item.appendChild(name);
                item.appendChild(removeBtn);
                grid.appendChild(item);
            } else {
                container.style.display = 'none';
            }
        }

        // 800Ã—800 ì´ë¯¸ì§€ ë¸”ë¡­ì—ì„œ 610Ã—477 ìƒì„±í•˜ëŠ” í•¨ìˆ˜
        function processImageFor610x477(imageBlob) {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = () => {
                    // 610Ã—477 ìº”ë²„ìŠ¤ ì„¤ì •
                    canvas.width = 610;
                    canvas.height = 477;
                    
                    // í°ìƒ‰ ë°°ê²½ ë¨¼ì € ê·¸ë¦¬ê¸°
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, 610, 477);
                    
                    // ê³ í’ˆì§ˆ ë Œë”ë§ ì„¤ì •
                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = 'high';
                    
                    // 1ë‹¨ê³„: 800Ã—800ì—ì„œ ìœ„ì•„ë˜ 120pxì”© ìë¥´ê¸° (800Ã—560)
                    const cropTop = 120;
                    const cropHeight = 560; // 800 - 120 - 120
                    
                    // 2ë‹¨ê³„: 610 ê¸°ì¤€ìœ¼ë¡œ ì¶•ì†Œ (800Ã—560 â†’ 610Ã—427)
                    const scale = 610 / 800;
                    const scaledWidth = 610;
                    const scaledHeight = cropHeight * scale; // 560 * 0.7625 = 427
                    
                    // 3ë‹¨ê³„: 610Ã—477 ìº”ë²„ìŠ¤ ì¤‘ì•™ì— ë°°ì¹˜
                    const x = 0; // ê°€ë¡œëŠ” ì •í™•íˆ ë§ìŒ
                    const y = (477 - scaledHeight) / 2; // ì„¸ë¡œ ì¤‘ì•™ ë°°ì¹˜
                    
                    ctx.drawImage(
                        img,
                        0, cropTop, 800, cropHeight,  // 800Ã—800ì—ì„œ ìœ„ì•„ë˜ 120px ìë¥¸ ì˜ì—­
                        x, y, scaledWidth, scaledHeight // 610Ã—477 ìº”ë²„ìŠ¤ì— ë°°ì¹˜
                    );
                    
                    canvas.toBlob(resolve, 'image/jpeg', 0.9);
                };
                
                img.src = URL.createObjectURL(imageBlob);
            });
        }

        // ìŠ¤ë§ˆíŠ¸ ë¦¬ì‚¬ì´ì§• + í¬ë¡­ í•¨ìˆ˜ (íƒ€ê²Ÿ í¬ê¸° ê³ ë ¤)
        function resizeImage(file, targetWidth, targetHeight, format, quality = 0.9) {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = () => {
                    // ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
                    canvas.width = targetWidth;
                    canvas.height = targetHeight;
                    
                    // í°ìƒ‰ ë°°ê²½ ë¨¼ì € ê·¸ë¦¬ê¸° (íˆ¬ëª… ë°°ê²½ ì²˜ë¦¬)
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, targetWidth, targetHeight);
                    
                    // ê³ í’ˆì§ˆ ë Œë”ë§ ì„¤ì •
                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = 'high';
                    
                    // ê¸°ì¡´ í¬ë¡­ ë°©ì‹ (800Ã—800 ë“± - ì´ì œ 610Ã—477 íŠ¹ë³„ ì²˜ë¦¬ ì œê±°)
                    const targetRatio = targetWidth / targetHeight;
                    const sourceRatio = img.width / img.height;
                    const MAX_SOURCE_SIZE = 1200;
                    
                    let workingWidth = img.width;
                    let workingHeight = img.height;
                    
                    // 1ë‹¨ê³„: ì›ë³¸ì´ ë„ˆë¬´ í¬ë©´ ë¨¼ì € ì¶•ì†Œ (ë¹„ìœ¨ ìœ ì§€)
                    const maxOriginalSide = Math.max(img.width, img.height);
                    if (maxOriginalSide > MAX_SOURCE_SIZE) {
                        const preScale = MAX_SOURCE_SIZE / maxOriginalSide;
                        workingWidth = img.width * preScale;
                        workingHeight = img.height * preScale;
                    }
                    
                    // 2ë‹¨ê³„: íƒ€ê²Ÿ í¬ê¸°ë¥¼ ê³ ë ¤í•œ ìµœì  í¬ê¸° ê³„ì‚°
                    let finalWidth, finalHeight;
                    let cropX, cropY, cropWidth, cropHeight;
                    
                    if (sourceRatio > targetRatio) {
                        // ì›ë³¸ì´ ë” ë„“ìŒ â†’ ì„¸ë¡œë¥¼ íƒ€ê²Ÿì— ë§ì¶° í™•ëŒ€, ê°€ë¡œëŠ” í¬ë¡­
                        finalHeight = Math.max(targetHeight, workingHeight);
                        finalWidth = finalHeight * sourceRatio;
                        
                        // í¬ë¡­ ì˜ì—­ ê³„ì‚° (ì¤‘ì•™ ê¸°ì¤€)
                        cropHeight = finalHeight;
                        cropWidth = finalHeight * targetRatio;
                        cropX = (finalWidth - cropWidth) / 2;
                        cropY = 0;
                    } else {
                        // ì›ë³¸ì´ ë” ë†’ìŒ â†’ ê°€ë¡œë¥¼ íƒ€ê²Ÿì— ë§ì¶° í™•ëŒ€, ì„¸ë¡œëŠ” í¬ë¡­
                        finalWidth = Math.max(targetWidth, workingWidth);
                        finalHeight = finalWidth / sourceRatio;
                        
                        // í¬ë¡­ ì˜ì—­ ê³„ì‚° (ì¤‘ì•™ ê¸°ì¤€)
                        cropWidth = finalWidth;
                        cropHeight = finalWidth / targetRatio;
                        cropX = 0;
                        cropY = (finalHeight - cropHeight) / 2;
                    }
                    
                    // ì›ë³¸ì„ ìµœì  í¬ê¸°ë¡œ ë¦¬ì‚¬ì´ì§•í•˜ë©´ì„œ ë™ì‹œì— í¬ë¡­
                    const scaleX = finalWidth / img.width;
                    const scaleY = finalHeight / img.height;
                    
                    ctx.drawImage(
                        img,
                        cropX / scaleX, cropY / scaleY, cropWidth / scaleX, cropHeight / scaleY,  // ì›ë³¸ì—ì„œì˜ í¬ë¡­ ì˜ì—­
                        0, 0, targetWidth, targetHeight  // íƒ€ê²Ÿ ì „ì²´ ì˜ì—­
                    );
                    
                    canvas.toBlob(resolve, format, quality);
                };
                
                img.src = URL.createObjectURL(file);
            });
        }

        // ì¸ë„¤ì¼ ì²˜ë¦¬
        document.getElementById('thumbnailProcess').addEventListener('click', async () => {
            const processBtn = document.getElementById('thumbnailProcess');
            const progressContainer = document.getElementById('thumbnailProgress');
            const progressFill = document.getElementById('thumbnailProgressFill');
            const progressText = document.getElementById('thumbnailProgressText');
            const resultContainer = document.getElementById('thumbnailResult');
            const statsElement = document.getElementById('thumbnailStats');

            processBtn.disabled = true;
            progressContainer.style.display = 'block';
            resultContainer.style.display = 'none';

            const zip = new JSZip();
            const totalFiles = thumbnailFiles.length;
            let processedFiles = 0;

            for (let i = 0; i < thumbnailFiles.length; i++) {
                const file = thumbnailFiles[i];
                
                // 1ë‹¨ê³„: 800Ã—800 ìƒì„± (ì„ì‹œë¡œ ì‚¬ìš©)
                const img800 = await resizeImage(file, 800, 800, 'image/jpeg', 0.9);
                
                // 2ë‹¨ê³„: 800Ã—800 ê²°ê³¼ë¬¼ë¡œ 610Ã—477 ìƒì„±
                const img610 = await processImageFor610x477(img800);
                const fileName610 = `b${i + 1}.jpg`;
                zip.file(fileName610, img610);
                
                processedFiles++;
                const progress = (processedFiles / totalFiles) * 100;
                progressFill.style.width = progress + '%';
                progressText.textContent = `ì²˜ë¦¬ ì¤‘... ${processedFiles}/${totalFiles}`;
            }

            thumbnailZip = zip;
            progressContainer.style.display = 'none';
            resultContainer.style.display = 'block';
            statsElement.textContent = `${thumbnailFiles.length}ê°œ ì´ë¯¸ì§€ë¡œ ${totalFiles}ê°œ íŒŒì¼ ìƒì„±`;
            processBtn.disabled = false;
        });

        // ë³¸ë¬¸ìš© ì²˜ë¦¬
        document.getElementById('contentProcess').addEventListener('click', async () => {
            const processBtn = document.getElementById('contentProcess');
            const progressContainer = document.getElementById('contentProgress');
            const progressFill = document.getElementById('contentProgressFill');
            const progressText = document.getElementById('contentProgressText');
            const resultContainer = document.getElementById('contentResult');
            const statsElement = document.getElementById('contentStats');

            processBtn.disabled = true;
            progressContainer.style.display = 'block';
            resultContainer.style.display = 'none';

            const zip = new JSZip();
            const sizes = [60, 120, 125, 130, 160, 180, 210, 240, 303, 470, 500, 800];
            const formats = [
                { ext: 'png', mime: 'image/png' },
                { ext: 'jpg', mime: 'image/jpeg' }
            ];
            
            const totalFiles = sizes.length * formats.length;
            let processedFiles = 0;

            for (const size of sizes) {
                for (const format of formats) {
                    const resizedBlob = await resizeImage(contentFile, size, size, format.mime, 0.9);
                    const fileName = `${size}x${size}.${format.ext}`;
                    zip.file(fileName, resizedBlob);
                    
                    processedFiles++;
                    const progress = (processedFiles / totalFiles) * 100;
                    progressFill.style.width = progress + '%';
                    progressText.textContent = `ì²˜ë¦¬ ì¤‘... ${processedFiles}/${totalFiles}`;
                }
            }

            contentZip = zip;
            progressContainer.style.display = 'none';
            resultContainer.style.display = 'block';
            statsElement.textContent = `1ê°œ ì´ë¯¸ì§€ë¡œ ${totalFiles}ê°œ íŒŒì¼ ìƒì„±`;
            processBtn.disabled = false;
        });

        // ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥
        document.getElementById('thumbnailDownload').addEventListener('click', async () => {
            if (thumbnailZip) {
                const content = await thumbnailZip.generateAsync({ type: 'blob' });
                const url = URL.createObjectURL(content);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'thumbnail-images.zip';
                a.click();
                URL.revokeObjectURL(url);
            }
        });

        document.getElementById('contentDownload').addEventListener('click', async () => {
            if (contentZip) {
                const content = await contentZip.generateAsync({ type: 'blob' });
                const url = URL.createObjectURL(content);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'content-images.zip';
                a.click();
                URL.revokeObjectURL(url);
            }
        });
    </script>
</body>
</html>